<% if @comment.errors.empty? %>
  $('#content').prepend(
    '<%= j render 'shared/flash', flash: tr(:comment, 'updated') %>'
  );

  <% publish_to "/questions/#{@question.id}/comments" do %>
    $('<%= class_with_id(@comment) %>').replaceWith(
      '<%= j render 'comments/comment', comment: @comment,
        commentable: @commentable %>'
    );
    $('<%= class_with_id(@comment) %>').css('background-color', '#fffff7');
    $('<%= class_with_id(@comment) %>').find('.controls').hide();
    if ($("header .user-name:contains('<%= @comment.user.name %>')").length) {
      $('<%= class_with_id(@comment) %>').find('.controls').show();
    }
  <% end %>

<% else %>
  $('#comment-<%= @comment.id %> form').replaceWith(
    '<%= j render 'comments/form', comment: @comment,
      commentable: @commentable, edit: true %>'
  );
<% end %>